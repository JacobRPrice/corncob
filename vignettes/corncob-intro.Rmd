---
title: "Introduction to corncob"
author: "Bryan D Martin"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Introduction to corncob}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

This tutorial is intended for STAMPS 2019.

When studying dysbiosis, the focus is often on identifying differentially abundant taxa. However, microbial imbalance can also affect the stability of taxa. Here, we introduce \texttt{corncob}, an individual taxon regression model that uses abundance tables and sample data. \texttt{corncob} is able to model differential abundance and differential variability. \texttt{corncob} is appropriate for both rare and common taxa, excessive zeros, overdispersion, and inconsistent sequencing depths.

To begin, we load an example data set as a \texttt{phyloseq} object.

```{r, message = FALSE}
library(corncob)
library(phyloseq)
data(soil_phylo)
```

If you are unfamiliar with \texttt{phyloseq}, we can view a description of the data using:

```{r}
soil_phylo
```

Let's examine a small subset of our data in more detail.
```{r}
otu_table(soil_phylo)[1:5, 1:5]
sample_data(soil_phylo)[1:5, ]
```

We now see that we have an OTU abundance table with 7770 OTUs and 119 samples, which we can extract using \texttt{otu_table()}. We also have 5 covariates associated with each sample, which we can extract using \texttt{sample_data()}. 

# Fitting a Model

Now, let's set up our model. We will demonstrate with OTU149.

First, let's subset our data to only include samples with the \texttt{DayAmdmt} covariate equal to 11 or 21.

```{r}
soil <- phyloseq::subset_samples(soil_phylo, DayAmdmt %in% c(11,21))
```

Next, let's fit our model. For now, we will not include any covariates, so we use \texttt{~ 1} as our model formula responses.

```{r}
mod <- bbdml(formula = OTU149 ~ DayAmdmt,
             phi.formula = ~ DayAmdmt,
             data = soil)
```

# Interpreting a Model

```{r}
plot(mod)
```

